{% extends "base.html" %}
{% block title %}Ngày {{ day }} • Chiến Dịch #{{ c.id }}{% endblock %}
{% block content %}
<h1>Ngày {{ day }}{% if c.total_days %} / {{ c.total_days }}{% endif %}</h1>

<!-- THANH TIẾN ĐỘ -->
<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>
<div class="progress-text">
    {{ learned }} / {{ total_cnt }} từ • Hoàn thành {{ percent }}%
</div>

<!-- STREAK SIÊU ĐẸP -->
<div class="streak-box">
    Streak: {{ current_streak }} ngày liên tục!
</div>

<!-- HUY HIỆU STREAK -->
{% if badges %}
<div class="badges-container">
    <h2>Thành Tựu Streak Của Bạn</h2>
    <div class="badges-grid">
        {% for b in badges %}
            {% if b == 3 %}<div class="badge bronze"><div>3</div><small>Đồng</small></div>{% endif %}
            {% if b == 7 %}<div class="badge silver"><div>7</div><small>Bạc</small></div>{% endif %}
            {% if b == 14 %}<div class="badge gold"><div>14</div><small>Vàng</small></div>{% endif %}
            {% if b == 30 %}<div class="badge platinum"><div>30</div><small>Bạch Kim</small></div>{% endif %}
            {% if b == 50 %}<div class="badge diamond"><div>50</div><small>Kim Cương</small></div>{% endif %}
            {% if b == 100 %}<div class="badge ruby"><div>100</div><small>Hồng Ngọc</small></div>{% endif %}
            {% if b == 365 %}<div class="badge legend"><div>365</div><small>LEGEND</small></div>{% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

<button class="btn" id="showBtn" onclick="showMeanings()">Hiển Thị Nghĩa</button>

{% if new %}
    <h2>Học Từ Mới Hôm Nay ({{ new|length }} từ)</h2>
    <form method="POST">
        <!-- phần hiển thị từ mới -->
{% for w in new %}
<li class="word-item">
    <input type="checkbox" name="new_words[]" value="{{ w.w }}" checked hidden>
    <span class="word">{{ w.w }}</span>
    <span class="ipa">{{ w.ipa }}</span>
    <span class="meaning">- {{ w.vn }}</span>
    <audio controls preload="none">
        <source src="{{ url_for('audio', w=w.w) }}" type="audio/mpeg">
    </audio>
</li>
{% endfor %}

<!-- HUY HIỆU -->
{% if badges %}
<div class="badges-container">
    <h2>Thành Tựu Streak</h2>
    <div class="badges-grid">
        {% for b in badges %}
            {% if b == 3 %}<div class="badge bronze"><div>3</div><small>Đồng</small></div>{% endif %}
            {% if b == 7 %}<div class="badge silver"><div>7</div><small>Bạc</small></div>{% endif %}
            {% if b == 14 %}<div class="badge gold"><div>14</div><small>Vàng</small></div>{% endif %}
            {% if b == 30 %}<div class="badge platinum"><div>30</div><small>Bạch Kim</small></div>{% endif %}
            {% if b == 50 %}<div class="badge diamond"><div>50</div><small>Kim Cương</small></div>{% endif %}
            {% if b == 100 %}<div class="badge ruby"><div>100</div><small>Hồng Ngọc</small></div>{% endif %}
            {% if b == 365 %}<div class="badge legend"><div>365</div><small>LEGEND</small></div>{% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}
        <button type="submit" class="btn" style="width:100%; padding:18px; font-size:1.4rem; margin-top:20px;">
            Hoàn Thành Buổi Học!
        </button>
    </form>
{% else %}
    <h2 style="color:#FFD700; text-align:center; font-size:3rem;">
        CHÚC MỪNG! BẠN ĐÃ HỌC HẾT TỪ VỰNG!
    </h2>
{% endif %}

<div style="margin-top:40px; text-align:center;">
    <button class="btn" onclick="location.href='/'">Trang Chủ</button>
    <button class="btn" onclick="location.href='/quiz/{{ c.id }}'">Quiz Ôn Tập</button>
</div>

<script>
function showMeanings() {
    document.querySelectorAll('.meaning').forEach(el => el.style.display = 'inline');
    document.getElementById('showBtn').style.display = 'none';
}
setTimeout(() => {
    document.getElementById('progressBar').style.width = '{{ percent }}%';
}, 300);
</script>
{% endblock %}